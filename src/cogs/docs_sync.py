"""Docs Sync â€” bridge ã® WebhookTriggerCog ã‚’ä½¿ã£ãŸ GitHub â†’ Claude Code ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°ã€‚

2ã¤ã®ãƒ¢ãƒ¼ãƒ‰:
- "ğŸ”„ docs-sync" (é€šå¸¸push): è‹±èªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®åŒæœŸã®ã¿ï¼ˆè»½é‡ãƒ»é«˜é€Ÿï¼‰
- "ğŸ”„ docs-sync-translate" (ãƒªãƒªãƒ¼ã‚¹æ™‚): å…¨è¨€èªç¿»è¨³ï¼ˆja, zh-CN, ko, es, pt-BR, frï¼‰

ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå®šç¾©ã®ã¿ã€‚å®Ÿè¡Œãƒ­ã‚¸ãƒƒã‚¯ã¯ claude_discord.cogs.webhook_trigger ã«å§”è­²ã€‚
"""

from __future__ import annotations

from claude_discord.cogs.webhook_trigger import WebhookTrigger

_COMMON_HEADER = """\
You are a documentation maintainer for the claude-code-discord-bridge project.
The repository is at /home/ebi/claude-code-discord-bridge.

## Step 1: Pull latest changes

```bash
cd /home/ebi/claude-code-discord-bridge && git pull origin main
```

## Step 2: Analyze what changed

Run `git diff HEAD~1 HEAD --stat` and `git diff HEAD~1 HEAD` to understand what changed.

## Step 3: Update English documentation if needed

If **source code** (.py files) changed:
- Read the changed code and check if README.md or CONTRIBUTING.md need updates
- Update sections about features, architecture, configuration, etc. if the code changes affect them
- Keep documentation accurate and in sync with the code
- Do NOT update docs for trivial changes (formatting, comments, internal refactors that don't change behavior)
"""

_TRANSLATE_STEP = """\

## Step 4: Translate to all supported languages

Target languages (create docs/{lang}/ for each):
- `ja` â€” Japanese (æ—¥æœ¬èª)
- `zh-CN` â€” Chinese Simplified (ç®€ä½“ä¸­æ–‡)
- `ko` â€” Korean (í•œêµ­ì–´)
- `es` â€” Spanish (EspaÃ±ol)
- `pt-BR` â€” Portuguese - Brazil (PortuguÃªs)
- `fr` â€” French (FranÃ§ais)

For each English doc (README.md, CONTRIBUTING.md), create or update its translation in every language directory.

Translation rules:
1. Keep all markdown formatting, code blocks, links, and badges intact
2. Do NOT translate: code snippets, URLs, file paths, variable names, "claude-code-discord-bridge", common English tech terms (CLI, API, Cog, thread, session, subprocess, etc.)
3. DO translate: headings, descriptions, explanatory text, table headers/descriptions, comments, notes
4. Add a bilingual notice at the top of each translated file (in English + the target language):
   ```
   > **Note:** This is an auto-translated version of the original English documentation.
   > If there are any discrepancies, the [English version](../../README.md) takes precedence.
   > (åŒã˜å†…å®¹ã‚’ãã®è¨€èªã§)
   ```
5. Use natural, fluent language â€” not mechanical translation. Write as a native speaker would
6. For README.md, update relative links to point to same-language versions where they exist
"""

_TRANSLATE_JA_STEP = """\

## Step 4: Translate to Japanese

Update or create Japanese translations in `docs/ja/` for each English doc (README.md, CONTRIBUTING.md).

Translation rules:
1. Keep all markdown formatting, code blocks, links, and badges intact
2. Do NOT translate: code snippets, URLs, file paths, variable names, "claude-code-discord-bridge", common English tech terms (CLI, API, Cog, thread, session, subprocess, etc.)
3. DO translate: headings, descriptions, explanatory text, table headers/descriptions, comments, notes
4. Add a bilingual notice at the top:
   ```
   > **Note:** This is an auto-translated version of the original English documentation.
   > If there are any discrepancies, the [English version](../../README.md) takes precedence.
   > **æ³¨æ„:** ã“ã‚Œã¯è‹±èªã®ã‚ªãƒªã‚¸ãƒŠãƒ«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è‡ªå‹•ç¿»è¨³ã—ãŸã‚‚ã®ã§ã™ã€‚
   > å†…å®¹ã«ç›¸é•ãŒã‚ã‚‹å ´åˆã¯ã€[è‹±èªç‰ˆ](../../README.md)ãŒå„ªå…ˆã•ã‚Œã¾ã™ã€‚
   ```
5. Use natural, fluent Japanese â€” not mechanical translation
6. Update relative links to point to Japanese versions where they exist
"""

_PR_STEP_SYNC = """\

## Step 5: Create a PR

If any documentation files were changed:

```bash
cd /home/ebi/claude-code-discord-bridge
git checkout -b docs-sync/$(date +%Y%m%d-%H%M%S)
git add -A
git commit -m "[docs-sync] Update documentation (English + Japanese)

Auto-generated by docs-sync workflow."
git push -u origin HEAD
gh pr create --title "[docs-sync] Update documentation (English + Japanese)" --body "Auto-generated documentation sync.

Changes:
- Updated English docs to reflect code changes (if applicable)
- Synchronized Japanese translation

This PR was automatically created by the docs-sync system."
```

If nothing changed, just report that docs are already up to date.

## Important
- NEVER modify source code (.py files) â€” only documentation (.md files)
- Commit messages MUST start with "[docs-sync]" to prevent infinite loops
- If unsure whether a code change needs doc updates, err on the side of NOT updating
"""

_PR_STEP_TRANSLATE = """\

## Step 5: Create a PR

If any files were changed:

```bash
cd /home/ebi/claude-code-discord-bridge
git checkout -b docs-sync/$(date +%Y%m%d-%H%M%S)
git add -A
git commit -m "[docs-sync] Update documentation and translations

Auto-generated by docs-sync workflow."
git push -u origin HEAD
gh pr create --title "[docs-sync] Update documentation and translations" --body "Auto-generated documentation sync.

Changes:
- Updated English docs to reflect code changes (if applicable)
- Synchronized translations (ja, zh-CN, ko, es, pt-BR, fr)

This PR was automatically created by the docs-sync system."
```

If nothing changed, just report that docs are already up to date.

## Important
- NEVER modify source code (.py files) â€” only documentation (.md files)
- Commit messages MUST start with "[docs-sync]" to prevent infinite loops
- If unsure whether a code change needs doc updates, err on the side of NOT updating
"""

# Assembled prompts
DOCS_SYNC_PROMPT = _COMMON_HEADER + _TRANSLATE_JA_STEP + _PR_STEP_SYNC
DOCS_TRANSLATE_PROMPT = _COMMON_HEADER + _TRANSLATE_STEP + _PR_STEP_TRANSLATE

# Trigger definitions for WebhookTriggerCog
BRIDGE_DIR = "/home/ebi/claude-code-discord-bridge"

DOCS_SYNC_TRIGGERS = {
    "ğŸ”„ docs-sync-translate": WebhookTrigger(
        prompt=DOCS_TRANSLATE_PROMPT,
        working_dir=BRIDGE_DIR,
        timeout=900,
    ),
    "ğŸ”„ docs-sync": WebhookTrigger(
        prompt=DOCS_SYNC_PROMPT,
        working_dir=BRIDGE_DIR,
        timeout=300,
    ),
}
