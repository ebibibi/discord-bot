"""Docs Sync ‚Äî bridge „ÅÆ WebhookTriggerCog „Çí‰Ωø„Å£„Åü GitHub ‚Üí Claude Code „Éâ„Ç≠„É•„É°„É≥„ÉàÊõ¥Êñ∞„ÄÇ

2„Å§„ÅÆ„É¢„Éº„Éâ:
- "üîÑ docs-sync" (ÈÄöÂ∏∏push): Ëã±Ë™û„Éâ„Ç≠„É•„É°„É≥„Éà„ÅÆÂêåÊúü„ÅÆ„ÅøÔºàËªΩÈáè„ÉªÈ´òÈÄüÔºâ
- "üîÑ docs-sync-translate" („É™„É™„Éº„ÇπÊôÇ): ÂÖ®Ë®ÄË™ûÁøªË®≥Ôºàja, zh-CN, ko, es, pt-BR, frÔºâ

„Åì„ÅÆ„Éï„Ç°„Ç§„É´„ÅØ„Éó„É≠„É≥„Éó„ÉàÂÆöÁæ©„ÅÆ„Åø„ÄÇÂÆüË°å„É≠„Ç∏„ÉÉ„ÇØ„ÅØ claude_discord.cogs.webhook_trigger „Å´ÂßîË≠≤„ÄÇ
"""

from __future__ import annotations

from claude_discord.cogs.webhook_trigger import WebhookTrigger

_COMMON_HEADER = """\
You are a documentation maintainer for the claude-code-discord-bridge project.
The repository is at /home/ebi/claude-code-discord-bridge.

## Step 1: Pull latest changes

```bash
cd /home/ebi/claude-code-discord-bridge && git pull origin main
```

## Step 2: Analyze what changed

Run `git diff HEAD~1 HEAD --stat` and `git diff HEAD~1 HEAD` to understand what changed.

## Step 3: Update English documentation if needed

If **source code** (.py files) changed:
- Read the changed code and check if README.md or CONTRIBUTING.md need updates
- Update sections about features, architecture, configuration, etc. if the code changes affect them
- Keep documentation accurate and in sync with the code
- Do NOT update docs for trivial changes (formatting, comments, internal refactors that don't change behavior)
"""

_TRANSLATE_STEP = """\

## Step 4: Translate to all supported languages

Target languages (create docs/{lang}/ for each):
- `ja` ‚Äî Japanese (Êó•Êú¨Ë™û)
- `zh-CN` ‚Äî Chinese Simplified (ÁÆÄ‰Ωì‰∏≠Êñá)
- `ko` ‚Äî Korean (ÌïúÍµ≠Ïñ¥)
- `es` ‚Äî Spanish (Espa√±ol)
- `pt-BR` ‚Äî Portuguese - Brazil (Portugu√™s)
- `fr` ‚Äî French (Fran√ßais)

For each English doc (README.md, CONTRIBUTING.md), create or update its translation in every language directory.

Translation rules:
1. Keep all markdown formatting, code blocks, links, and badges intact
2. Do NOT translate: code snippets, URLs, file paths, variable names, "claude-code-discord-bridge", common English tech terms (CLI, API, Cog, thread, session, subprocess, etc.)
3. DO translate: headings, descriptions, explanatory text, table headers/descriptions, comments, notes
4. Add a bilingual notice at the top of each translated file (in English + the target language):
   ```
   > **Note:** This is an auto-translated version of the original English documentation.
   > If there are any discrepancies, the [English version](../../README.md) takes precedence.
   > (Âêå„ÅòÂÜÖÂÆπ„Çí„Åù„ÅÆË®ÄË™û„Åß)
   ```
5. Use natural, fluent language ‚Äî not mechanical translation. Write as a native speaker would
6. For README.md, update relative links to point to same-language versions where they exist
"""

_TRANSLATE_JA_STEP = """\

## Step 4: Translate to Japanese

Update or create Japanese translations in `docs/ja/` for each English doc (README.md, CONTRIBUTING.md).

Translation rules:
1. Keep all markdown formatting, code blocks, links, and badges intact
2. Do NOT translate: code snippets, URLs, file paths, variable names, "claude-code-discord-bridge", common English tech terms (CLI, API, Cog, thread, session, subprocess, etc.)
3. DO translate: headings, descriptions, explanatory text, table headers/descriptions, comments, notes
4. Add a bilingual notice at the top:
   ```
   > **Note:** This is an auto-translated version of the original English documentation.
   > If there are any discrepancies, the [English version](../../README.md) takes precedence.
   > **Ê≥®ÊÑè:** „Åì„Çå„ÅØËã±Ë™û„ÅÆ„Ç™„É™„Ç∏„Éä„É´„Éâ„Ç≠„É•„É°„É≥„Éà„ÇíËá™ÂãïÁøªË®≥„Åó„Åü„ÇÇ„ÅÆ„Åß„Åô„ÄÇ
   > ÂÜÖÂÆπ„Å´Áõ∏ÈÅï„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØ„ÄÅ[Ëã±Ë™ûÁâà](../../README.md)„ÅåÂÑ™ÂÖà„Åï„Çå„Åæ„Åô„ÄÇ
   ```
5. Use natural, fluent Japanese ‚Äî not mechanical translation
6. Update relative links to point to Japanese versions where they exist
"""

_PR_STEP_SYNC = """\

## Step 5: Create a PR with auto-merge

If any documentation files were changed:

1. Create a branch and commit:
```bash
cd /home/ebi/claude-code-discord-bridge
git checkout -b docs-sync/$(date +%Y%m%d-%H%M%S)
git add -A
git commit -m "[docs-sync] Update documentation (English + Japanese)

Auto-generated by docs-sync workflow."
git push -u origin HEAD
```

2. Write a PR body file with a **bilingual summary** based on your analysis from Step 2.
   The body MUST follow this format:

```markdown
## Summary
- (1-3 bullet points describing what changed and why, in English)

## Ê¶ÇË¶Å
- (Same content in Japanese)

## Changed files
- `file1.md`
- `file2.md`

---
ü§ñ Auto-generated by [docs-sync](https://github.com/ebibibi/claude-code-discord-bridge)
```

Write this to a temp file and use `--body-file`:
```bash
gh pr create --title "[docs-sync] Update documentation (English + Japanese)" --body-file /tmp/docs-sync-pr-body.md
```

3. Enable auto-merge so it merges automatically after CI passes:
```bash
gh pr merge --auto --squash
```

If nothing changed, just report that docs are already up to date.

## Important
- NEVER modify source code (.py files) ‚Äî only documentation (.md files)
- Commit messages MUST start with "[docs-sync]" to prevent infinite loops
- If unsure whether a code change needs doc updates, err on the side of NOT updating
- The PR summary must be specific (e.g. "Added WebhookTrigger docs"), NOT generic (e.g. "Updated docs")
"""

_PR_STEP_TRANSLATE = """\

## Step 5: Create a PR with auto-merge

If any files were changed:

1. Create a branch and commit:
```bash
cd /home/ebi/claude-code-discord-bridge
git checkout -b docs-sync/$(date +%Y%m%d-%H%M%S)
git add -A
git commit -m "[docs-sync] Update documentation and translations

Auto-generated by docs-sync workflow."
git push -u origin HEAD
```

2. Write a PR body file with a **bilingual summary** based on your analysis from Step 2.
   The body MUST follow this format:

```markdown
## Summary
- (1-3 bullet points describing what changed and why, in English)

## Ê¶ÇË¶Å
- (Same content in Japanese)

## Changed files
- `file1.md`
- `docs/ja/file1.md`
- ...

## Languages updated
ja, zh-CN, ko, es, pt-BR, fr

---
ü§ñ Auto-generated by [docs-sync](https://github.com/ebibibi/claude-code-discord-bridge)
```

Write this to a temp file and use `--body-file`:
```bash
gh pr create --title "[docs-sync] Update documentation and translations" --body-file /tmp/docs-sync-pr-body.md
```

3. Enable auto-merge so it merges automatically after CI passes:
```bash
gh pr merge --auto --squash
```

If nothing changed, just report that docs are already up to date.

## Important
- NEVER modify source code (.py files) ‚Äî only documentation (.md files)
- Commit messages MUST start with "[docs-sync]" to prevent infinite loops
- If unsure whether a code change needs doc updates, err on the side of NOT updating
- The PR summary must be specific (e.g. "Added WebhookTrigger docs"), NOT generic (e.g. "Updated docs")
"""

# Assembled prompts
DOCS_SYNC_PROMPT = _COMMON_HEADER + _TRANSLATE_JA_STEP + _PR_STEP_SYNC
DOCS_TRANSLATE_PROMPT = _COMMON_HEADER + _TRANSLATE_STEP + _PR_STEP_TRANSLATE

# Trigger definitions for WebhookTriggerCog
BRIDGE_DIR = "/home/ebi/claude-code-discord-bridge"

DOCS_SYNC_TRIGGERS = {
    "üîÑ docs-sync-translate": WebhookTrigger(
        prompt=DOCS_TRANSLATE_PROMPT,
        working_dir=BRIDGE_DIR,
        timeout=900,
    ),
    "üîÑ docs-sync": WebhookTrigger(
        prompt=DOCS_SYNC_PROMPT,
        working_dir=BRIDGE_DIR,
        timeout=300,
    ),
}
